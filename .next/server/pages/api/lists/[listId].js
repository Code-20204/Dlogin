"use strict";(()=>{var e={};e.id=99,e.ids=[99],e.modules={2104:e=>{e.exports=require("@next-auth/prisma-adapter")},3524:e=>{e.exports=require("@prisma/client")},8432:e=>{e.exports=require("bcryptjs")},6011:e=>{e.exports=require("date-fns/addDays")},557:e=>{e.exports=require("date-fns/endOfDay")},3864:e=>{e.exports=require("date-fns/endOfWeek")},4038:e=>{e.exports=require("date-fns/isAfter")},3024:e=>{e.exports=require("date-fns/isBefore")},7436:e=>{e.exports=require("date-fns/isEqual")},7585:e=>{e.exports=require("date-fns/startOfDay")},2659:e=>{e.exports=require("date-fns/startOfWeek")},3227:e=>{e.exports=require("next-auth")},2113:e=>{e.exports=require("next-auth/next")},7449:e=>{e.exports=require("next-auth/providers/credentials")},7459:e=>{e.exports=require("next-auth/providers/github")},3598:e=>{e.exports=require("next-auth/providers/google")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},600:(e,t,r)=>{r.r(t),r.d(t,{config:()=>f,default:()=>p,routeModule:()=>c});var s={};r.r(s),r.d(s,{default:()=>handler});var a=r(1802),i=r(7153),n=r(6249),o=r(2113),u=r(8417),d=r(4637),l=r(6070);async function handler(e,t){let r=await (0,o.getServerSession)(e,t,u.authOptions);if(!r)return t.status(401).json({message:"Unauthorized"});let{listId:s}=e.query,a=r.user.id;switch(e.method){case"GET":try{let e=await d._.list.findFirst({where:{id:s,userId:a},include:{items:{orderBy:{createdAt:"desc"}}}});if(!e)return t.status(404).json({message:"List not found"});if("AUTO"===e.type&&e.rules){let t=await d._.list.findMany({where:{userId:a},include:{items:!0}}),r=t.flatMap(e=>e.items),s=(0,l.tr)(r,e.rules);e.items=s}t.status(200).json(e)}catch(e){console.error("Get list error:",e),t.status(500).json({message:"Internal server error"})}break;case"PUT":try{let{title:r,type:i,rules:n}=e.body,o=await d._.list.findFirst({where:{id:s,userId:a}});if(!o)return t.status(404).json({message:"List not found"});if("AUTO"===i&&n){let e=n.filter(e=>!(0,l.fX)(e));if(e.length>0)return t.status(400).json({message:"Invalid automation rules",invalidRules:e})}let u=await d._.list.update({where:{id:s},data:{title:r||o.title,type:i||o.type,rules:void 0!==n?n:o.rules},include:{items:{orderBy:{createdAt:"desc"}}}});t.status(200).json(u)}catch(e){console.error("Update list error:",e),t.status(500).json({message:"Internal server error"})}break;case"DELETE":try{let e=await d._.list.findFirst({where:{id:s,userId:a}});if(!e)return t.status(404).json({message:"List not found"});await d._.list.delete({where:{id:s}}),t.status(200).json({message:"List deleted successfully"})}catch(e){console.error("Delete list error:",e),t.status(500).json({message:"Internal server error"})}break;default:t.status(405).json({message:"Method not allowed"})}}let p=(0,n.l)(s,"default"),f=(0,n.l)(s,"config"),c=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/lists/[listId]",pathname:"/api/lists/[listId]",bundlePath:"",filename:""},userland:s})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222,417,70],()=>__webpack_exec__(600));module.exports=r})();