"use strict";(()=>{var e={};e.id=7,e.ids=[7],e.modules={3524:e=>{e.exports=require("@prisma/client")},8432:e=>{e.exports=require("bcryptjs")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6326:e=>{e.exports=import("resend")},6113:e=>{e.exports=require("crypto")},9654:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{config:()=>u,default:()=>d,routeModule:()=>c});var s=t(1802),i=t(7153),l=t(6249),o=t(2917),n=e([o]);o=(n.then?(await n)():n)[0];let d=(0,l.l)(o,"default"),u=(0,l.l)(o,"config"),c=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/register",pathname:"/api/auth/register",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},4637:(e,a,t)=>{t.d(a,{_:()=>i});var r=t(3524);let s=globalThis,i=s.prisma??new r.PrismaClient({log:["query"]})},2917:(e,a,t)=>{t.a(e,async(e,r)=>{try{t.r(a),t.d(a,{default:()=>handler});var s=t(4637),i=t(8432),l=t.n(i),o=t(7818),n=t(6635),d=t(6113),u=t.n(d),c=e([o]);async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"Method not allowed"});let{email:t,password:r,name:i}=e.body;if(!t||!r)return a.status(400).json({message:"Email and password are required"});if(r.length<6)return a.status(400).json({message:"Password must be at least 6 characters"});try{let e=await s._.user.findUnique({where:{email:t}});if(e)return a.status(400).json({message:"User already exists"});let d=l().hashSync(r,12),c=u().randomBytes(32).toString("hex"),m=new Date(Date.now()+864e5),p=await s._.user.create({data:{email:t,password:d,name:i||t.split("@")[0],emailVerificationToken:c,emailTokenExpiry:m}});await s._.list.create({data:{title:"我的任务",type:"MANUAL",userId:p.id}});let h=[{title:"本周到期",type:"AUTO",rules:[{field:"dueDate",operator:"<=",value:"endOfWeek"}],userId:p.id},{title:"已过期",type:"AUTO",rules:[{field:"dueDate",operator:"<",value:"now"},{field:"completed",operator:"=",value:!1}],userId:p.id},{title:"高优先级",type:"AUTO",rules:[{field:"priority",operator:"=",value:"high"}],userId:p.id}];await s._.list.createMany({data:h});try{let e=(0,n.xc)(c);await (0,o.zk)(p.email,p.name,e)}catch(e){console.error("Failed to send verification email:",e)}try{await (0,o.Pi)(p.email,p.name)}catch(e){console.error("Failed to send welcome email:",e)}a.status(201).json({message:"User created successfully. Please check your email to verify your account.",user:{id:p.id,email:p.email,name:p.name,isEmailVerified:p.isEmailVerified},requiresVerification:!0})}catch(e){console.error("Registration error:",e),a.status(500).json({message:"Internal server error"})}}o=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[222,818],()=>__webpack_exec__(9654));module.exports=t})();