"use strict";(()=>{var e={};e.id=351,e.ids=[351],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2123:(e,r,i)=>{i.r(r),i.d(r,{config:()=>d,default:()=>o,routeModule:()=>u});var a={};i.r(a),i.d(a,{default:()=>handler});var t=i(1802),n=i(7153),s=i(6249),l=i(4637);async function handler(e,r){if("GET"!==e.method)return r.status(405).json({message:"Method not allowed"});let{token:i}=e.query;if(!i)return r.status(400).json({message:"Verification token is required"});try{let e=await l._.user.findFirst({where:{emailVerificationToken:i,emailTokenExpiry:{gt:new Date}}});if(!e)return r.redirect("/login?error=invalid_token&message=验证链接无效或已过期");if(e.isEmailVerified)return r.redirect("/dashboard?message=邮箱已验证");await l._.user.update({where:{id:e.id},data:{isEmailVerified:!0,emailVerified:new Date,emailVerificationToken:null,emailTokenExpiry:null}}),r.redirect("/dashboard?message=邮箱验证成功！您现在可以使用所有功能了")}catch(e){console.error("Email verification error:",e),r.redirect("/login?error=server_error&message=验证过程中发生错误")}}let o=(0,s.l)(a,"default"),d=(0,s.l)(a,"config"),u=new t.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/auth/verify-email",pathname:"/api/auth/verify-email",bundlePath:"",filename:""},userland:a})},4637:(e,r,i)=>{i.d(r,{_:()=>n});var a=i(3524);let t=globalThis,n=t.prisma??new a.PrismaClient({log:["query"]})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),i=r.X(0,[222],()=>__webpack_exec__(2123));module.exports=i})();