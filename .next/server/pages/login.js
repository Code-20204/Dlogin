"use strict";(()=>{var e={};e.id=459,e.ids=[459,660,888],e.modules={390:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>x,default:()=>u,getServerSideProps:()=>p,getStaticPaths:()=>g,getStaticProps:()=>m,reportWebVitals:()=>h,routeModule:()=>v,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>j,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>b});var a=r(7093),i=r(5244),l=r(1323),n=r(4003),o=r(9597),d=r(7644),c=e([o]);o=(c.then?(await c)():c)[0];let u=(0,l.l)(d,"default"),m=(0,l.l)(d,"getStaticProps"),g=(0,l.l)(d,"getStaticPaths"),p=(0,l.l)(d,"getServerSideProps"),x=(0,l.l)(d,"config"),h=(0,l.l)(d,"reportWebVitals"),b=(0,l.l)(d,"unstable_getStaticProps"),f=(0,l.l)(d,"unstable_getStaticPaths"),y=(0,l.l)(d,"unstable_getStaticParams"),w=(0,l.l)(d,"unstable_getServerProps"),j=(0,l.l)(d,"unstable_getServerSideProps"),v=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/login",pathname:"/login",bundlePath:"",filename:""},components:{App:o.default,Document:n.default},userland:d});s()}catch(e){s(e)}})},4003:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Document});var s=r(997),a=r(6859);function Document(){return(0,s.jsxs)(a.Html,{lang:"en",children:[s.jsx(a.Head,{}),(0,s.jsxs)("body",{children:[s.jsx(a.Main,{}),s.jsx(a.NextScript,{})]})]})}},7644:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Login,getServerSideProps:()=>getServerSideProps});var s=r(997),a=r(6689),i=r(1649),l=r(1163);r(1664);var n=r(9162),o=r(6953),d=r(1607),c=r(4464);function Login(){let[e,t]=(0,a.useState)(!0),[r,u]=(0,a.useState)(!1),[m,g]=(0,a.useState)(!1),[p,x]=(0,a.useState)(""),[h,b]=(0,a.useState)({email:"",password:"",name:""}),f=(0,l.useRouter)(),handleSubmit=async t=>{t.preventDefault(),g(!0),x("");try{if(e){let e=await (0,i.signIn)("credentials",{email:h.email,password:h.password,redirect:!1});e?.error?x("邮箱或密码错误"):f.push("/dashboard")}else{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),t=await e.json();if(e.ok){let e=await (0,i.signIn)("credentials",{email:h.email,password:h.password,redirect:!1});e?.error||f.push("/dashboard")}else x(t.message||"注册失败")}}catch(e){x("网络错误，请重试")}finally{g(!1)}},handleOAuthSignIn=async e=>{g(!0);try{await (0,i.signIn)(e,{callbackUrl:"/dashboard"})}catch(e){x("登录失败，请重试"),g(!1)}};return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:s.jsx("div",{className:"max-w-md w-full space-y-8",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"DLogin 任务管理"}),s.jsx("p",{className:"text-gray-600",children:e?"登录您的账户":"创建新账户"})]}),p&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:p}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsxs)("button",{onClick:()=>handleOAuthSignIn("github"),disabled:m,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[s.jsx(n.Z,{className:"w-5 h-5 mr-3"}),"使用 GitHub 登录"]}),(0,s.jsxs)("button",{onClick:()=>handleOAuthSignIn("google"),disabled:m,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[s.jsx(o.Z,{className:"w-5 h-5 mr-3"}),"使用 Google 登录"]})]}),(0,s.jsxs)("div",{className:"relative mb-6",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("div",{className:"w-full border-t border-gray-300"})}),s.jsx("div",{className:"relative flex justify-center text-sm",children:s.jsx("span",{className:"px-2 bg-white text-gray-500",children:"或"})})]}),(0,s.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[!e&&(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"姓名"}),s.jsx("input",{id:"name",type:"text",value:h.name,onChange:e=>b({...h,name:e.target.value}),className:"w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"请输入您的姓名"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"邮箱地址"}),s.jsx("input",{id:"email",type:"email",required:!0,value:h.email,onChange:e=>b({...h,email:e.target.value}),className:"w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"请输入您的邮箱"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"密码"}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx("input",{id:"password",type:r?"text":"password",required:!0,value:h.password,onChange:e=>b({...h,password:e.target.value}),className:"w-full px-3 py-3 pr-10 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:e?"请输入密码":"请设置密码（至少6位）",minLength:e?void 0:6}),s.jsx("button",{type:"button",onClick:()=>u(!r),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:r?s.jsx(d.Z,{className:"h-5 w-5 text-gray-400"}):s.jsx(c.Z,{className:"h-5 w-5 text-gray-400"})})]})]}),s.jsx("button",{type:"submit",disabled:m,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:m?"处理中...":e?"登录":"注册"})]}),s.jsx("div",{className:"mt-6 text-center",children:s.jsx("button",{onClick:()=>{t(!e),x(""),b({email:"",password:"",name:""})},className:"text-indigo-600 hover:text-indigo-500 text-sm font-medium",children:e?"没有账户？立即注册":"已有账户？立即登录"})})]})})})}async function getServerSideProps(e){let t=await (0,i.getSession)(e);return t?{redirect:{destination:"/dashboard",permanent:!1}}:{props:{}}}},1649:e=>{e.exports=require("next-auth/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9752:e=>{e.exports=import("@tanstack/react-query")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[859,130,163,297,664,973,597],()=>__webpack_exec__(390));module.exports=r})();