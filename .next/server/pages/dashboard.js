"use strict";(()=>{var e={};e.id=26,e.ids=[26,888,660],e.modules={1298:(e,t,s)=>{s.a(e,async(e,l)=>{try{s.r(t),s.d(t,{config:()=>h,default:()=>u,getServerSideProps:()=>g,getStaticPaths:()=>m,getStaticProps:()=>x,reportWebVitals:()=>p,routeModule:()=>N,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>j,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>f});var a=s(7093),r=s(5244),i=s(1323),n=s(4003),d=s(9597),o=s(4615),c=e([d]);d=(c.then?(await c)():c)[0];let u=(0,i.l)(o,"default"),x=(0,i.l)(o,"getStaticProps"),m=(0,i.l)(o,"getStaticPaths"),g=(0,i.l)(o,"getServerSideProps"),h=(0,i.l)(o,"config"),p=(0,i.l)(o,"reportWebVitals"),f=(0,i.l)(o,"unstable_getStaticProps"),b=(0,i.l)(o,"unstable_getStaticPaths"),j=(0,i.l)(o,"unstable_getStaticParams"),v=(0,i.l)(o,"unstable_getServerProps"),y=(0,i.l)(o,"unstable_getServerSideProps"),N=new a.PagesRouteModule({definition:{kind:r.x.PAGES,page:"/dashboard",pathname:"/dashboard",bundlePath:"",filename:""},components:{App:d.default,Document:n.default},userland:o});l()}catch(e){l(e)}})},4003:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Document});var l=s(997),a=s(6859);function Document(){return(0,l.jsxs)(a.Html,{lang:"en",children:[l.jsx(a.Head,{}),(0,l.jsxs)("body",{children:[l.jsx(a.Main,{}),l.jsx(a.NextScript,{})]})]})}},4615:(e,t,s)=>{s.r(t),s.d(t,{default:()=>DashboardPage});var l=s(997),a=s(6689),r=s(1649),i=s(1163);s(1664);var n=s(4933),d=s(8051),o=s(5976),c=s(3756),u=s(5077),x=s(1853),m=s(1012);function AuthGuard({children:e}){let{data:t,status:s}=(0,r.useSession)(),n=(0,i.useRouter)();return((0,a.useEffect)(()=>{if("loading"!==s&&!t){n.push("/login");return}},[t,s,n]),"loading"===s)?l.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"验证身份中..."})]})}):t?e:null}var g=s(9461),h=s(5351),p=s(316),f=s(4622),b=s(8272),j=s(5169),v=s(3718);let y=require("date-fns/format");var N=s.n(y);require("date-fns/isAfter");let w=require("date-fns/isBefore");var D=s.n(w);let k=require("date-fns/locale");function ListView({list:e,onUpdate:t,onDelete:s}){let[r,i]=(0,a.useState)(e?.items||[]),[n,d]=(0,a.useState)(!1),[o,u]=(0,a.useState)(null),[x,y]=(0,a.useState)({title:"",description:"",dueDate:"",priority:"medium"});(0,a.useEffect)(()=>{i(e?.items||[])},[e]);let handleAddItem=async s=>{if(s.preventDefault(),x.title.trim())try{let s=await fetch(`/api/lists/${e.id}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...x,dueDate:x.dueDate||null})});if(s.ok){let e=await s.json();i([e,...r]),y({title:"",description:"",dueDate:"",priority:"medium"}),d(!1),t()}}catch(e){console.error("Failed to add item:",e)}},handleUpdateItem=async(e,s)=>{try{let l=await fetch(`/api/items/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(l.ok){let s=await l.json();i(r.map(t=>t.id===e?s:t)),t()}}catch(e){console.error("Failed to update item:",e)}},handleDeleteItem=async e=>{if(confirm("确定要删除这个任务吗？"))try{let s=await fetch(`/api/items/${e}`,{method:"DELETE"});s.ok&&(i(r.filter(t=>t.id!==e)),t())}catch(e){console.error("Failed to delete item:",e)}},toggleComplete=e=>{handleUpdateItem(e.id,{completed:!e.completed})},getPriorityColor=e=>{switch(e){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},getPriorityLabel=e=>{switch(e){case"high":return"高";case"medium":default:return"中";case"low":return"低"}},isOverdue=e=>!!e&&D()(new Date(e),new Date)&&!r.find(t=>t.dueDate===e)?.completed,formatDueDate=e=>e?N()(new Date(e),"MM月dd日",{locale:k.zhCN}):null;return(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,l.jsxs)("div",{className:"p-6 border-b",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[l.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:e.title}),"AUTO"===e.type&&(0,l.jsxs)("div",{className:"flex items-center px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs",children:[l.jsx(g.Z,{className:"w-3 h-3 mr-1"}),"智能列表"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:["MANUAL"===e.type&&(0,l.jsxs)("button",{onClick:()=>d(!0),className:"flex items-center px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[l.jsx(m.Z,{className:"w-4 h-4 mr-2"}),"添加任务"]}),l.jsx("div",{className:"relative",children:l.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:l.jsx(h.Z,{className:"w-5 h-5"})})})]})]}),"AUTO"===e.type&&l.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"此列表根据设定规则自动显示符合条件的任务"})]}),n&&"MANUAL"===e.type&&l.jsx("div",{className:"p-6 border-b bg-gray-50",children:(0,l.jsxs)("form",{onSubmit:handleAddItem,className:"space-y-4",children:[l.jsx("div",{children:l.jsx("input",{type:"text",value:x.title,onChange:e=>y({...x,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"任务标题",required:!0})}),l.jsx("div",{children:l.jsx("textarea",{value:x.description,onChange:e=>y({...x,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"任务描述（可选）",rows:2})}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"截止日期"}),l.jsx("input",{type:"date",value:x.dueDate,onChange:e=>y({...x,dueDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"优先级"}),(0,l.jsxs)("select",{value:x.priority,onChange:e=>y({...x,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[l.jsx("option",{value:"low",children:"低"}),l.jsx("option",{value:"medium",children:"中"}),l.jsx("option",{value:"high",children:"高"})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3",children:[l.jsx("button",{type:"button",onClick:()=>{d(!1),y({title:"",description:"",dueDate:"",priority:"medium"})},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"取消"}),l.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"添加任务"})]})]})}),l.jsx("div",{className:"divide-y divide-gray-200",children:0===r.length?(0,l.jsxs)("div",{className:"p-12 text-center",children:[l.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx(c.Z,{className:"w-6 h-6 text-gray-400"})}),l.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"AUTO"===e.type?"暂无符合条件的任务":"暂无任务"}),l.jsx("p",{className:"text-gray-600",children:"AUTO"===e.type?"当有任务符合此列表的自动化规则时，它们会自动显示在这里":"点击上方按钮添加您的第一个任务"})]}):r.map(t=>l.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[l.jsx("button",{onClick:()=>toggleComplete(t),className:"mt-1 flex-shrink-0",children:t.completed?l.jsx(c.Z,{className:"w-5 h-5 text-green-600"}):l.jsx(p.Z,{className:"w-5 h-5 text-gray-400 hover:text-gray-600"})}),l.jsx("div",{className:"flex-1 min-w-0",children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[l.jsx("h4",{className:`text-sm font-medium ${t.completed?"text-gray-500 line-through":"text-gray-900"}`,children:t.title}),t.description&&l.jsx("p",{className:`text-sm mt-1 ${t.completed?"text-gray-400 line-through":"text-gray-600"}`,children:t.description}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[t.dueDate&&(0,l.jsxs)("div",{className:`flex items-center text-xs ${isOverdue(t.dueDate)&&!t.completed?"text-red-600":t.completed?"text-gray-400":"text-gray-600"}`,children:[l.jsx(f.Z,{className:"w-3 h-3 mr-1"}),formatDueDate(t.dueDate)]}),(0,l.jsxs)("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs ${t.completed?"text-gray-400 bg-gray-100":getPriorityColor(t.priority)}`,children:[l.jsx(b.Z,{className:"w-3 h-3 mr-1"}),getPriorityLabel(t.priority)]})]})]}),"MANUAL"===e.type&&(0,l.jsxs)("div",{className:"flex items-center space-x-1 ml-4",children:[l.jsx("button",{onClick:()=>u(t),className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:l.jsx(j.Z,{className:"w-4 h-4"})}),l.jsx("button",{onClick:()=>handleDeleteItem(t.id),className:"p-1 text-gray-400 hover:text-red-600 rounded",children:l.jsx(v.Z,{className:"w-4 h-4"})})]})]})})]})},t.id))}),o&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:l.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:(0,l.jsxs)("div",{className:"p-6",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"编辑任务"}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData(e.target),s={title:t.get("title"),description:t.get("description"),dueDate:t.get("dueDate")||null,priority:t.get("priority")};handleUpdateItem(o.id,s),u(null)},className:"space-y-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"任务标题"}),l.jsx("input",{name:"title",type:"text",defaultValue:o.title,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"任务描述"}),l.jsx("textarea",{name:"description",defaultValue:o.description||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:3})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"截止日期"}),l.jsx("input",{name:"dueDate",type:"date",defaultValue:o.dueDate?o.dueDate.split("T")[0]:"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"优先级"}),(0,l.jsxs)("select",{name:"priority",defaultValue:o.priority,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[l.jsx("option",{value:"low",children:"低"}),l.jsx("option",{value:"medium",children:"中"}),l.jsx("option",{value:"high",children:"高"})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[l.jsx("button",{type:"button",onClick:()=>u(null),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"取消"}),l.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"保存"})]})]})]})})})]})}var S=s(1352);require("date-fns/startOfWeek"),require("date-fns/endOfWeek"),require("date-fns/startOfDay"),require("date-fns/endOfDay"),require("date-fns/addDays"),require("date-fns/isEqual");let C={thisWeek:{name:"本周到期",rules:[{field:"dueDate",operator:"<=",value:"endOfWeek"}]},overdue:{name:"已过期",rules:[{field:"dueDate",operator:"<",value:"now"},{field:"completed",operator:"=",value:!1}]},highPriority:{name:"高优先级",rules:[{field:"priority",operator:"=",value:"high"}]},completed:{name:"已完成",rules:[{field:"completed",operator:"=",value:!0}]},pending:{name:"待完成",rules:[{field:"completed",operator:"=",value:!1}]}};function AutoListBuilder({onSubmit:e,onCancel:t}){let[s,r]=(0,a.useState)("MANUAL"),[i,n]=(0,a.useState)(""),[d,o]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1),[x,h]=(0,a.useState)({field:"dueDate",operator:"<=",value:"endOfWeek"}),p=[{value:"dueDate",label:"截止日期"},{value:"completed",label:"完成状态"},{value:"priority",label:"优先级"},{value:"title",label:"标题"},{value:"description",label:"描述"}],f={dueDate:[{value:"<=",label:"早于或等于"},{value:"<",label:"早于"},{value:">=",label:"晚于或等于"},{value:">",label:"晚于"},{value:"=",label:"等于"}],completed:[{value:"=",label:"等于"},{value:"!=",label:"不等于"}],priority:[{value:"=",label:"等于"},{value:"!=",label:"不等于"},{value:"in",label:"包含在"}],title:[{value:"contains",label:"包含"},{value:"startsWith",label:"开始于"},{value:"endsWith",label:"结束于"},{value:"equals",label:"等于"}],description:[{value:"contains",label:"包含"},{value:"startsWith",label:"开始于"},{value:"endsWith",label:"结束于"},{value:"equals",label:"等于"}]},b={dueDate:[{value:"today",label:"今天"},{value:"tomorrow",label:"明天"},{value:"endOfWeek",label:"本周末"},{value:"startOfWeek",label:"本周开始"},{value:"now",label:"现在"}],completed:[{value:!0,label:"已完成"},{value:!1,label:"未完成"}],priority:[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"}]},removeRule=e=>{o(d.filter((t,s)=>s!==e))},applyTemplate=e=>{let t=C[e];t&&(n(t.name),o(t.rules),r("AUTO"))},getRuleDescription=e=>{let t=p.find(t=>t.value===e.field)?.label,s=f[e.field]?.find(t=>t.value===e.operator)?.label,l=e.value;return"dueDate"===e.field?l=b.dueDate.find(t=>t.value===e.value)?.label||e.value:"completed"===e.field?l=e.value?"已完成":"未完成":"priority"===e.field&&(l=b.priority.find(t=>t.value===e.value)?.label||e.value),`${t} ${s} ${l}`};return l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:l.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[l.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"创建新列表"}),l.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:l.jsx(S.Z,{className:"w-5 h-5"})})]}),(0,l.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),!i.trim())return;let l={title:i.trim(),type:s,rules:"AUTO"===s?d:null};e(l)},className:"space-y-6",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"列表名称"}),l.jsx("input",{type:"text",value:i,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"输入列表名称",required:!0})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"列表类型"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>r("MANUAL"),className:`p-4 border-2 rounded-lg text-left transition-colors ${"MANUAL"===s?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[l.jsx("div",{className:"font-medium text-gray-900",children:"手动列表"}),l.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"手动添加和管理任务项目"})]}),(0,l.jsxs)("button",{type:"button",onClick:()=>r("AUTO"),className:`p-4 border-2 rounded-lg text-left transition-colors ${"AUTO"===s?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[(0,l.jsxs)("div",{className:"flex items-center",children:[l.jsx(g.Z,{className:"w-4 h-4 text-yellow-500 mr-2"}),l.jsx("span",{className:"font-medium text-gray-900",children:"智能列表"})]}),l.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"基于规则自动筛选任务"})]})]})]}),"AUTO"===s&&(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"快速模板"}),l.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(C).map(([e,t])=>l.jsx("button",{type:"button",onClick:()=>applyTemplate(e),className:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-colors",children:l.jsx("div",{className:"font-medium text-gray-900 text-sm",children:t.name})},e))})]}),"AUTO"===s&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[l.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"自动化规则"}),(0,l.jsxs)("button",{type:"button",onClick:()=>u(!0),className:"flex items-center px-3 py-1 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:[l.jsx(m.Z,{className:"w-4 h-4 mr-1"}),"添加规则"]})]}),l.jsx("div",{className:"space-y-2 mb-4",children:d.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[l.jsx("span",{className:"text-sm text-gray-700",children:getRuleDescription(e)}),l.jsx("button",{type:"button",onClick:()=>removeRule(t),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:l.jsx(v.Z,{className:"w-4 h-4"})})]},t))}),c&&(0,l.jsxs)("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:[(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"字段"}),l.jsx("select",{value:x.field,onChange:e=>h({...x,field:e.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",children:p.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"操作符"}),l.jsx("select",{value:x.operator,onChange:e=>h({...x,operator:e.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",children:f[x.field]?.map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)("div",{children:[l.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"值"}),b[x.field]?l.jsx("select",{value:x.value,onChange:e=>{let t=e.target.value;"completed"===x.field&&(t="true"===t),h({...x,value:t})},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",children:b[x.field].map(e=>l.jsx("option",{value:e.value,children:e.label},e.value))}):l.jsx("input",{type:"text",value:x.value,onChange:e=>h({...x,value:e.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"输入值"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[l.jsx("button",{type:"button",onClick:()=>u(!1),className:"px-3 py-1 text-sm text-gray-600 hover:bg-gray-200 rounded transition-colors",children:"取消"}),l.jsx("button",{type:"button",onClick:()=>{x.field&&x.operator&&void 0!==x.value&&(o([...d,{...x}]),h({field:"dueDate",operator:"<=",value:"endOfWeek"}),u(!1))},className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors",children:"添加"})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[l.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"取消"}),l.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"创建列表"})]})]})]})})})}function EmailVerificationBanner({user:e,onVerificationSent:t}){let{data:s}=(0,r.useSession)(),[i,n]=(0,a.useState)(!1),[d,o]=(0,a.useState)(""),[c,u]=(0,a.useState)(!1);if(!e||e.isEmailVerified||c)return null;let handleResendVerification=async()=>{try{n(!0),o("");let s=await fetch("/api/auth/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email})}),l=await s.json();if(!s.ok)throw Error(l.message||"发送失败");o("验证邮件已发送，请检查您的邮箱"),t&&t()}catch(e){o(`发送失败：${e.message}`)}finally{n(!1)}},x=(()=>{if(!e.createdAt)return 0;let t=new Date(e.createdAt),s=new Date;return Math.floor((s-t)/864e5)})(),m=x>=1;return l.jsx("div",{className:`border-l-4 p-4 mb-6 ${m?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"}`,children:(0,l.jsxs)("div",{className:"flex",children:[l.jsx("div",{className:"flex-shrink-0",children:m?l.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:l.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}):l.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:l.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{className:"ml-3 flex-1",children:[l.jsx("h3",{className:`text-sm font-medium ${m?"text-red-800":"text-yellow-800"}`,children:m?"⚠️ 紧急：邮箱验证":"\uD83D\uDCE7 邮箱验证"}),(0,l.jsxs)("div",{className:`mt-2 text-sm ${m?"text-red-700":"text-yellow-700"}`,children:[(0,l.jsxs)("p",{children:["您的邮箱地址 ",l.jsx("strong",{children:e.email})," 尚未验证。",m&&(0,l.jsxs)("span",{className:"block mt-1 font-medium",children:["已超过 ",x," 天未验证，部分功能可能受限。"]})]}),d&&l.jsx("div",{className:`mt-2 p-2 rounded text-xs ${d.includes("失败")?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"}`,children:d}),(0,l.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[l.jsx("button",{onClick:handleResendVerification,disabled:i,className:`inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded ${m?"text-red-700 bg-red-100 hover:bg-red-200 focus:ring-red-500":"text-yellow-700 bg-yellow-100 hover:bg-yellow-200 focus:ring-yellow-500"} focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed`,children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-3 w-3",fill:"none",viewBox:"0 0 24 24",children:[l.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),l.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"发送中..."]}):"\uD83D\uDCE4 重新发送验证邮件"}),l.jsx("button",{onClick:()=>u(!0),className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"暂时关闭"})]})]})]})]})})}function Dashboard(){let{data:e}=(0,r.useSession)();(0,i.useRouter)();let[t,s]=(0,a.useState)([]),[g,h]=(0,a.useState)(null),[p,f]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!0),[v,y]=(0,a.useState)(null),[N,w]=(0,a.useState)({total:0,completed:0,pending:0,overdue:0});(0,a.useEffect)(()=>{fetchUserInfo(),fetchLists()},[]);let fetchUserInfo=async()=>{try{let e=await fetch("/api/user/profile");if(e.ok){let t=await e.json();y(t)}}catch(e){console.error("Failed to fetch user info:",e)}},fetchLists=async()=>{try{let e=await fetch("/api/lists");if(e.ok){let t=await e.json();s(t);let l=t.flatMap(e=>e.items||[]),a=new Date;w({total:l.length,completed:l.filter(e=>e.completed).length,pending:l.filter(e=>!e.completed).length,overdue:l.filter(e=>!e.completed&&e.dueDate&&new Date(e.dueDate)<a).length}),t.length>0&&!g&&h(t[0])}}catch(e){console.error("Failed to fetch lists:",e)}finally{j(!1)}},handleCreateList=async e=>{try{let l=await fetch("/api/lists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(l.ok){let e=await l.json();s([...t,e]),h(e),f(!1)}}catch(e){console.error("Failed to create list:",e)}},handleDeleteList=async e=>{if(confirm("确定要删除这个列表吗？"))try{let l=await fetch(`/api/lists/${e}`,{method:"DELETE"});if(l.ok){let l=t.filter(t=>t.id!==e);s(l),g?.id===e&&h(l[0]||null)}}catch(e){console.error("Failed to delete list:",e)}};return b?l.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"加载中..."})]})}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[l.jsx("header",{className:"bg-white shadow-sm border-b",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex justify-between items-center h-16",children:[l.jsx("div",{className:"flex items-center",children:l.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"DLogin 任务管理"})}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[l.jsx(n.Z,{className:"w-4 h-4"}),l.jsx("span",{children:e?.user?.name||e?.user?.email})]}),(0,l.jsxs)("button",{onClick:()=>(0,r.signOut)({callbackUrl:"/login"}),className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[l.jsx(d.Z,{className:"w-4 h-4"}),l.jsx("span",{children:"退出"})]})]})]})})}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[v&&!v.isEmailVerified&&l.jsx(EmailVerificationBanner,{user:v,onVerificationSent:fetchUserInfo}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[l.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[l.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:l.jsx(o.Z,{className:"w-6 h-6 text-blue-600"})}),(0,l.jsxs)("div",{className:"ml-4",children:[l.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总任务"}),l.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.total})]})]})}),l.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[l.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:l.jsx(c.Z,{className:"w-6 h-6 text-green-600"})}),(0,l.jsxs)("div",{className:"ml-4",children:[l.jsx("p",{className:"text-sm font-medium text-gray-600",children:"已完成"}),l.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.completed})]})]})}),l.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[l.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:l.jsx(u.Z,{className:"w-6 h-6 text-yellow-600"})}),(0,l.jsxs)("div",{className:"ml-4",children:[l.jsx("p",{className:"text-sm font-medium text-gray-600",children:"待完成"}),l.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.pending})]})]})}),l.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,l.jsxs)("div",{className:"flex items-center",children:[l.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:l.jsx(x.Z,{className:"w-6 h-6 text-red-600"})}),(0,l.jsxs)("div",{className:"ml-4",children:[l.jsx("p",{className:"text-sm font-medium text-gray-600",children:"已过期"}),l.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.overdue})]})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[l.jsx("div",{className:"lg:col-span-1",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[l.jsx("div",{className:"p-6 border-b",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[l.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"我的列表"}),l.jsx("button",{onClick:()=>f(!0),className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:l.jsx(m.Z,{className:"w-5 h-5"})})]})}),l.jsx("div",{className:"p-4",children:l.jsx("div",{className:"space-y-2",children:t.map(e=>l.jsx("button",{onClick:()=>h(e),className:`w-full text-left p-3 rounded-lg transition-colors ${g?.id===e.id?"bg-indigo-50 text-indigo-700 border border-indigo-200":"hover:bg-gray-50 text-gray-700"}`,children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[l.jsx("p",{className:"font-medium",children:e.title}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:[e._count?.items||0," 项任务","AUTO"===e.type&&" • 自动"]})]}),"AUTO"===e.type&&l.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"})]})},e.id))})})]})}),l.jsx("div",{className:"lg:col-span-3",children:g?l.jsx(ListView,{list:g,onUpdate:fetchLists,onDelete:handleDeleteList}):(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[l.jsx(o.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"选择一个列表"}),l.jsx("p",{className:"text-gray-600 mb-6",children:"从左侧选择一个列表来查看和管理任务"}),(0,l.jsxs)("button",{onClick:()=>f(!0),className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[l.jsx(m.Z,{className:"w-4 h-4 mr-2"}),"创建新列表"]})]})})]})]}),p&&l.jsx(AutoListBuilder,{onSubmit:handleCreateList,onCancel:()=>f(!1)})]})}function DashboardPage(){return l.jsx(AuthGuard,{children:l.jsx(Dashboard,{})})}},1649:e=>{e.exports=require("next-auth/react")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},9752:e=>{e.exports=import("@tanstack/react-query")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[859,450,792,163,446,597],()=>__webpack_exec__(1298));module.exports=s})();