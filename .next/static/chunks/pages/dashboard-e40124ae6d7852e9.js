(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{1075:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return l(7801)}])},9415:function(e,t,l){"use strict";l.d(t,{Z:function(){return AuthGuard}});var s=l(5893),a=l(3299),r=l(1163),i=l(7294);function AuthGuard(e){let{children:t}=e,{data:l,status:n}=(0,a.useSession)(),d=(0,r.useRouter)();return((0,i.useEffect)(()=>{if("loading"!==n&&!l){d.push("/login");return}},[l,n,d]),"loading"===n)?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"验证身份中..."})]})}):l?t:null}},7801:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return DashboardPage}});var s=l(5893),a=l(7294),r=l(3299),i=l(1163);l(1664);var n=l(4933),d=l(8051),o=l(5976),c=l(3756),u=l(5077),x=l(1853),m=l(1012),h=l(9415),g=l(9461),p=l(5351),f=l(316),b=l(4622),v=l(8272),j=l(5169),y=l(3718),N=l(8058),w=l(313),D=l(3644);function ListView(e){let{list:t,onUpdate:l,onDelete:r}=e,[i,n]=(0,a.useState)((null==t?void 0:t.items)||[]),[d,o]=(0,a.useState)(!1),[u,x]=(0,a.useState)(null),[h,k]=(0,a.useState)({title:"",description:"",dueDate:"",priority:"medium"});(0,a.useEffect)(()=>{n((null==t?void 0:t.items)||[])},[t]);let handleAddItem=async e=>{if(e.preventDefault(),h.title.trim())try{let e=await fetch("/api/lists/".concat(t.id,"/items"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...h,dueDate:h.dueDate||null})});if(e.ok){let t=await e.json();n([t,...i]),k({title:"",description:"",dueDate:"",priority:"medium"}),o(!1),l()}}catch(e){console.error("Failed to add item:",e)}},handleUpdateItem=async(e,t)=>{try{let s=await fetch("/api/items/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok){let t=await s.json();n(i.map(l=>l.id===e?t:l)),l()}}catch(e){console.error("Failed to update item:",e)}},handleDeleteItem=async e=>{if(confirm("确定要删除这个任务吗？"))try{let t=await fetch("/api/items/".concat(e),{method:"DELETE"});t.ok&&(n(i.filter(t=>t.id!==e)),l())}catch(e){console.error("Failed to delete item:",e)}},toggleComplete=e=>{handleUpdateItem(e.id,{completed:!e.completed})},getPriorityColor=e=>{switch(e){case"high":return"text-red-600 bg-red-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}},getPriorityLabel=e=>{switch(e){case"high":return"高";case"medium":default:return"中";case"low":return"低"}},isOverdue=e=>{var t;return!!e&&(0,w.Z)(new Date(e),new Date)&&!(null===(t=i.find(t=>t.dueDate===e))||void 0===t?void 0:t.completed)},formatDueDate=e=>e?(0,N.Z)(new Date(e),"MM月dd日",{locale:D.Z}):null;return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsxs)("div",{className:"p-6 border-b",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:t.title}),"AUTO"===t.type&&(0,s.jsxs)("div",{className:"flex items-center px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs",children:[(0,s.jsx)(g.Z,{className:"w-3 h-3 mr-1"}),"智能列表"]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:["MANUAL"===t.type&&(0,s.jsxs)("button",{onClick:()=>o(!0),className:"flex items-center px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"添加任务"]}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:(0,s.jsx)(p.Z,{className:"w-5 h-5"})})})]})]}),"AUTO"===t.type&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"此列表根据设定规则自动显示符合条件的任务"})]}),d&&"MANUAL"===t.type&&(0,s.jsx)("div",{className:"p-6 border-b bg-gray-50",children:(0,s.jsxs)("form",{onSubmit:handleAddItem,className:"space-y-4",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"text",value:h.title,onChange:e=>k({...h,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"任务标题",required:!0})}),(0,s.jsx)("div",{children:(0,s.jsx)("textarea",{value:h.description,onChange:e=>k({...h,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"任务描述（可选）",rows:2})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"截止日期"}),(0,s.jsx)("input",{type:"date",value:h.dueDate,onChange:e=>k({...h,dueDate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"优先级"}),(0,s.jsxs)("select",{value:h.priority,onChange:e=>k({...h,priority:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"low",children:"低"}),(0,s.jsx)("option",{value:"medium",children:"中"}),(0,s.jsx)("option",{value:"high",children:"高"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{o(!1),k({title:"",description:"",dueDate:"",priority:"medium"})},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"取消"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"添加任务"})]})]})}),(0,s.jsx)("div",{className:"divide-y divide-gray-200",children:0===i.length?(0,s.jsxs)("div",{className:"p-12 text-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(c.Z,{className:"w-6 h-6 text-gray-400"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"AUTO"===t.type?"暂无符合条件的任务":"暂无任务"}),(0,s.jsx)("p",{className:"text-gray-600",children:"AUTO"===t.type?"当有任务符合此列表的自动化规则时，它们会自动显示在这里":"点击上方按钮添加您的第一个任务"})]}):i.map(e=>(0,s.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("button",{onClick:()=>toggleComplete(e),className:"mt-1 flex-shrink-0",children:e.completed?(0,s.jsx)(c.Z,{className:"w-5 h-5 text-green-600"}):(0,s.jsx)(f.Z,{className:"w-5 h-5 text-gray-400 hover:text-gray-600"})}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"text-sm font-medium ".concat(e.completed?"text-gray-500 line-through":"text-gray-900"),children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm mt-1 ".concat(e.completed?"text-gray-400 line-through":"text-gray-600"),children:e.description}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[e.dueDate&&(0,s.jsxs)("div",{className:"flex items-center text-xs ".concat(isOverdue(e.dueDate)&&!e.completed?"text-red-600":e.completed?"text-gray-400":"text-gray-600"),children:[(0,s.jsx)(b.Z,{className:"w-3 h-3 mr-1"}),formatDueDate(e.dueDate)]}),(0,s.jsxs)("div",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs ".concat(e.completed?"text-gray-400 bg-gray-100":getPriorityColor(e.priority)),children:[(0,s.jsx)(v.Z,{className:"w-3 h-3 mr-1"}),getPriorityLabel(e.priority)]})]})]}),"MANUAL"===t.type&&(0,s.jsxs)("div",{className:"flex items-center space-x-1 ml-4",children:[(0,s.jsx)("button",{onClick:()=>x(e),className:"p-1 text-gray-400 hover:text-gray-600 rounded",children:(0,s.jsx)(j.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>handleDeleteItem(e.id),className:"p-1 text-gray-400 hover:text-red-600 rounded",children:(0,s.jsx)(y.Z,{className:"w-4 h-4"})})]})]})})]})},e.id))}),u&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"编辑任务"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData(e.target),l={title:t.get("title"),description:t.get("description"),dueDate:t.get("dueDate")||null,priority:t.get("priority")};handleUpdateItem(u.id,l),x(null)},className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"任务标题"}),(0,s.jsx)("input",{name:"title",type:"text",defaultValue:u.title,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"任务描述"}),(0,s.jsx)("textarea",{name:"description",defaultValue:u.description||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",rows:3})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"截止日期"}),(0,s.jsx)("input",{name:"dueDate",type:"date",defaultValue:u.dueDate?u.dueDate.split("T")[0]:"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"优先级"}),(0,s.jsxs)("select",{name:"priority",defaultValue:u.priority,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"low",children:"低"}),(0,s.jsx)("option",{value:"medium",children:"中"}),(0,s.jsx)("option",{value:"high",children:"高"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"取消"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"保存"})]})]})]})})})]})}var k=l(1352);let C={thisWeek:{name:"本周到期",rules:[{field:"dueDate",operator:"<=",value:"endOfWeek"}]},overdue:{name:"已过期",rules:[{field:"dueDate",operator:"<",value:"now"},{field:"completed",operator:"=",value:!1}]},highPriority:{name:"高优先级",rules:[{field:"priority",operator:"=",value:"high"}]},completed:{name:"已完成",rules:[{field:"completed",operator:"=",value:!0}]},pending:{name:"待完成",rules:[{field:"completed",operator:"=",value:!1}]}};function AutoListBuilder(e){var t;let{onSubmit:l,onCancel:r}=e,[i,n]=(0,a.useState)("MANUAL"),[d,o]=(0,a.useState)(""),[c,u]=(0,a.useState)([]),[x,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)({field:"dueDate",operator:"<=",value:"endOfWeek"}),b=[{value:"dueDate",label:"截止日期"},{value:"completed",label:"完成状态"},{value:"priority",label:"优先级"},{value:"title",label:"标题"},{value:"description",label:"描述"}],v={dueDate:[{value:"<=",label:"早于或等于"},{value:"<",label:"早于"},{value:">=",label:"晚于或等于"},{value:">",label:"晚于"},{value:"=",label:"等于"}],completed:[{value:"=",label:"等于"},{value:"!=",label:"不等于"}],priority:[{value:"=",label:"等于"},{value:"!=",label:"不等于"},{value:"in",label:"包含在"}],title:[{value:"contains",label:"包含"},{value:"startsWith",label:"开始于"},{value:"endsWith",label:"结束于"},{value:"equals",label:"等于"}],description:[{value:"contains",label:"包含"},{value:"startsWith",label:"开始于"},{value:"endsWith",label:"结束于"},{value:"equals",label:"等于"}]},j={dueDate:[{value:"today",label:"今天"},{value:"tomorrow",label:"明天"},{value:"endOfWeek",label:"本周末"},{value:"startOfWeek",label:"本周开始"},{value:"now",label:"现在"}],completed:[{value:!0,label:"已完成"},{value:!1,label:"未完成"}],priority:[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"}]},removeRule=e=>{u(c.filter((t,l)=>l!==e))},applyTemplate=e=>{let t=C[e];t&&(o(t.name),u(t.rules),n("AUTO"))},getRuleDescription=e=>{var t,l,s,a,r;let i=null===(t=b.find(t=>t.value===e.field))||void 0===t?void 0:t.label,n=null===(s=v[e.field])||void 0===s?void 0:null===(l=s.find(t=>t.value===e.operator))||void 0===l?void 0:l.label,d=e.value;return"dueDate"===e.field?d=(null===(a=j.dueDate.find(t=>t.value===e.value))||void 0===a?void 0:a.label)||e.value:"completed"===e.field?d=e.value?"已完成":"未完成":"priority"===e.field&&(d=(null===(r=j.priority.find(t=>t.value===e.value))||void 0===r?void 0:r.label)||e.value),"".concat(i," ").concat(n," ").concat(d)};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"创建新列表"}),(0,s.jsx)("button",{onClick:r,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg",children:(0,s.jsx)(k.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!d.trim())return;let t={title:d.trim(),type:i,rules:"AUTO"===i?c:null};l(t)},className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"列表名称"}),(0,s.jsx)("input",{type:"text",value:d,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"输入列表名称",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"列表类型"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>n("MANUAL"),className:"p-4 border-2 rounded-lg text-left transition-colors ".concat("MANUAL"===i?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:"手动列表"}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"手动添加和管理任务项目"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>n("AUTO"),className:"p-4 border-2 rounded-lg text-left transition-colors ".concat("AUTO"===i?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-gray-300"),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(g.Z,{className:"w-4 h-4 text-yellow-500 mr-2"}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"智能列表"})]}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"基于规则自动筛选任务"})]})]})]}),"AUTO"===i&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"快速模板"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(C).map(e=>{let[t,l]=e;return(0,s.jsx)("button",{type:"button",onClick:()=>applyTemplate(t),className:"p-3 text-left border border-gray-200 rounded-lg hover:border-indigo-300 hover:bg-indigo-50 transition-colors",children:(0,s.jsx)("div",{className:"font-medium text-gray-900 text-sm",children:l.name})},t)})})]}),"AUTO"===i&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"自动化规则"}),(0,s.jsxs)("button",{type:"button",onClick:()=>h(!0),className:"flex items-center px-3 py-1 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-1"}),"添加规则"]})]}),(0,s.jsx)("div",{className:"space-y-2 mb-4",children:c.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,s.jsx)("span",{className:"text-sm text-gray-700",children:getRuleDescription(e)}),(0,s.jsx)("button",{type:"button",onClick:()=>removeRule(t),className:"p-1 text-red-500 hover:bg-red-50 rounded",children:(0,s.jsx)(y.Z,{className:"w-4 h-4"})})]},t))}),x&&(0,s.jsxs)("div",{className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"字段"}),(0,s.jsx)("select",{value:p.field,onChange:e=>f({...p,field:e.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",children:b.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"操作符"}),(0,s.jsx)("select",{value:p.operator,onChange:e=>f({...p,operator:e.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",children:null===(t=v[p.field])||void 0===t?void 0:t.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"值"}),j[p.field]?(0,s.jsx)("select",{value:p.value,onChange:e=>{let t=e.target.value;"completed"===p.field&&(t="true"===t),f({...p,value:t})},className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",children:j[p.field].map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}):(0,s.jsx)("input",{type:"text",value:p.value,onChange:e=>f({...p,value:e.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"输入值"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>h(!1),className:"px-3 py-1 text-sm text-gray-600 hover:bg-gray-200 rounded transition-colors",children:"取消"}),(0,s.jsx)("button",{type:"button",onClick:()=>{p.field&&p.operator&&void 0!==p.value&&(u([...c,{...p}]),f({field:"dueDate",operator:"<=",value:"endOfWeek"}),h(!1))},className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded hover:bg-indigo-700 transition-colors",children:"添加"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[(0,s.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"取消"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"创建列表"})]})]})]})})})}function EmailVerificationBanner(e){let{user:t,onVerificationSent:l}=e,{data:i}=(0,r.useSession)(),[n,d]=(0,a.useState)(!1),[o,c]=(0,a.useState)(""),[u,x]=(0,a.useState)(!1);if(!t||t.isEmailVerified||u)return null;let handleResendVerification=async()=>{try{d(!0),c("");let e=await fetch("/api/auth/send-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email})}),s=await e.json();if(!e.ok)throw Error(s.message||"发送失败");c("验证邮件已发送，请检查您的邮箱"),l&&l()}catch(e){c("发送失败：".concat(e.message))}finally{d(!1)}},m=(()=>{if(!t.createdAt)return 0;let e=new Date(t.createdAt),l=new Date;return Math.floor((l-e)/864e5)})(),h=m>=1;return(0,s.jsx)("div",{className:"border-l-4 p-4 mb-6 ".concat(h?"bg-red-50 border-red-400":"bg-yellow-50 border-yellow-400"),children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:h?(0,s.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}):(0,s.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,s.jsxs)("div",{className:"ml-3 flex-1",children:[(0,s.jsx)("h3",{className:"text-sm font-medium ".concat(h?"text-red-800":"text-yellow-800"),children:h?"⚠️ 紧急：邮箱验证":"\uD83D\uDCE7 邮箱验证"}),(0,s.jsxs)("div",{className:"mt-2 text-sm ".concat(h?"text-red-700":"text-yellow-700"),children:[(0,s.jsxs)("p",{children:["您的邮箱地址 ",(0,s.jsx)("strong",{children:t.email})," 尚未验证。",h&&(0,s.jsxs)("span",{className:"block mt-1 font-medium",children:["已超过 ",m," 天未验证，部分功能可能受限。"]})]}),o&&(0,s.jsx)("div",{className:"mt-2 p-2 rounded text-xs ".concat(o.includes("失败")?"bg-red-100 text-red-700 border border-red-200":"bg-green-100 text-green-700 border border-green-200"),children:o}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,s.jsx)("button",{onClick:handleResendVerification,disabled:n,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded ".concat(h?"text-red-700 bg-red-100 hover:bg-red-200 focus:ring-red-500":"text-yellow-700 bg-yellow-100 hover:bg-yellow-200 focus:ring-yellow-500"," focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"),children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-3 w-3",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"发送中..."]}):"\uD83D\uDCE4 重新发送验证邮件"}),(0,s.jsx)("button",{onClick:()=>x(!0),className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"暂时关闭"})]})]})]})]})})}function Dashboard(){var e,t;let{data:l}=(0,r.useSession)();(0,i.useRouter)();let[h,g]=(0,a.useState)([]),[p,f]=(0,a.useState)(null),[b,v]=(0,a.useState)(!1),[j,y]=(0,a.useState)(!0),[N,w]=(0,a.useState)(null),[D,k]=(0,a.useState)({total:0,completed:0,pending:0,overdue:0});(0,a.useEffect)(()=>{fetchUserInfo(),fetchLists()},[]);let fetchUserInfo=async()=>{try{let e=await fetch("/api/user/profile");if(e.ok){let t=await e.json();w(t)}}catch(e){console.error("Failed to fetch user info:",e)}},fetchLists=async()=>{try{let e=await fetch("/api/lists");if(e.ok){let t=await e.json();g(t);let l=t.flatMap(e=>e.items||[]),s=new Date;k({total:l.length,completed:l.filter(e=>e.completed).length,pending:l.filter(e=>!e.completed).length,overdue:l.filter(e=>!e.completed&&e.dueDate&&new Date(e.dueDate)<s).length}),t.length>0&&!p&&f(t[0])}}catch(e){console.error("Failed to fetch lists:",e)}finally{y(!1)}},handleCreateList=async e=>{try{let t=await fetch("/api/lists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok){let e=await t.json();g([...h,e]),f(e),v(!1)}}catch(e){console.error("Failed to create list:",e)}},handleDeleteList=async e=>{if(confirm("确定要删除这个列表吗？"))try{let t=await fetch("/api/lists/".concat(e),{method:"DELETE"});if(t.ok){let t=h.filter(t=>t.id!==e);g(t),(null==p?void 0:p.id)===e&&f(t[0]||null)}}catch(e){console.error("Failed to delete list:",e)}};return j?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"加载中..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"DLogin 任务管理"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,s.jsx)(n.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:(null==l?void 0:null===(e=l.user)||void 0===e?void 0:e.name)||(null==l?void 0:null===(t=l.user)||void 0===t?void 0:t.email)})]}),(0,s.jsxs)("button",{onClick:()=>(0,r.signOut)({callbackUrl:"/login"}),className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"退出"})]})]})]})})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[N&&!N.isEmailVerified&&(0,s.jsx)(EmailVerificationBanner,{user:N,onVerificationSent:fetchUserInfo}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,s.jsx)(o.Z,{className:"w-6 h-6 text-blue-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"总任务"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:D.total})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,s.jsx)(c.Z,{className:"w-6 h-6 text-green-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已完成"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:D.completed})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,s.jsx)(u.Z,{className:"w-6 h-6 text-yellow-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"待完成"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:D.pending})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,s.jsx)(x.Z,{className:"w-6 h-6 text-red-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"已过期"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:D.overdue})]})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-6 border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"我的列表"}),(0,s.jsx)("button",{onClick:()=>v(!0),className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",children:(0,s.jsx)(m.Z,{className:"w-5 h-5"})})]})}),(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"space-y-2",children:h.map(e=>{var t;return(0,s.jsx)("button",{onClick:()=>f(e),className:"w-full text-left p-3 rounded-lg transition-colors ".concat((null==p?void 0:p.id)===e.id?"bg-indigo-50 text-indigo-700 border border-indigo-200":"hover:bg-gray-50 text-gray-700"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.title}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:[(null===(t=e._count)||void 0===t?void 0:t.items)||0," 项任务","AUTO"===e.type&&" • 自动"]})]}),"AUTO"===e.type&&(0,s.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"})]})},e.id)})})})]})}),(0,s.jsx)("div",{className:"lg:col-span-3",children:p?(0,s.jsx)(ListView,{list:p,onUpdate:fetchLists,onDelete:handleDeleteList}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,s.jsx)(o.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"选择一个列表"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"从左侧选择一个列表来查看和管理任务"}),(0,s.jsxs)("button",{onClick:()=>v(!0),className:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"创建新列表"]})]})})]})]}),b&&(0,s.jsx)(AutoListBuilder,{onSubmit:handleCreateList,onCancel:()=>v(!1)})]})}function DashboardPage(){return(0,s.jsx)(h.Z,{children:(0,s.jsx)(Dashboard,{})})}}},function(e){e.O(0,[701,157,774,888,179],function(){return e(e.s=1075)}),_N_E=e.O()}]);